# who_is_the_spy_multiagent

**重要提示：本项目绝大部分代码由 Gemini 2.5 Pro 生成，作者本人无法保证项目整体的安全性、可靠性，代码极大概率存在安全漏洞。因此，我强烈建议，本项目应仅用于个人娱乐用，务必不要将其用于更加严肃的场合内！！！**

一个基于大语言模型的多智能体“谁是卧底”游戏模拟程序。

本项目通过 Web 界面实时展示若干个 AI 智能体进行“谁是卧底”游戏的完整过程，包括每轮的发言、投票和最终的游戏结果。

## 一、 主要功能

-   **全自动游戏流程**：程序启动后，AI 玩家会自动完成发言、投票、淘汰等所有游戏环节，直至分出胜负。
-   **动态AI交互**：每个AI玩家都会根据场上已有的发言历史来组织自己的描述，并基于所有人的发言进行分析和投票。
-   **实时战况直播**：游戏日志、玩家发言和投票理由会通过流式传输实时显示在前端页面上，方便观察战局。
-   **上帝视角**：前端页面提供“上帝视角”开关，开启后可以查看所有玩家的身份（平民/卧底）和他们拿到的具体词语。
-   **动态淘汰机制**：每轮投票后，得票最多的玩家会被淘汰出局。 如果卧底被淘汰，则平民胜利；如果卧底存活到最后（场上剩余2人），则卧底胜利。
-   **人工调整智能体数量**：用户可以通过配置项或前端选项自由设定游戏的总人数和平民/卧底的数量。
-   **最大游戏轮数限制**：增加了可选的“最大回合数”限制。如果在指定回合数内卧底仍未被找出，则判定卧底胜利，避免游戏陷入僵局。

## 二、 如何运行

#### 1. 克隆仓库

```bash
git clone <你的仓库链接>
cd who_is_the_spy_multiagent
```

#### 2. 安装依赖

建议创建一个 Python 虚拟环境。项目依赖已在 `requirements.txt` 文件中列出，请使用以下命令安装：

```bash
pip install -r requirements.txt
```

#### 3. 配置 API 密钥

a. 本项目选择调用字节跳动[火山引擎](https://www.volcengine.com/)中的[豆包大模型](https://www.volcengine.com/product/doubao)，请使用者自行前往火山引擎生成自己的 API 密钥，笔者此处不再赘述。

b. 在项目根目录下，复制 `api_env_sample.env` 文件并重命名为`api_env.env`。

c. 在新建的 `.env` 文件中，添加你的 API 密钥，格式如下：

   ```
   ARK_API_KEY="YOUR_API_KEY_HERE"

   # 例如
   ARK_API_KEY="abcdabcd_abcd_1111"
   ```

d. **（重要！）** 为了防止密钥泄露，请务必在 `.gitignore` 文件中将您的密钥文件添加进去，确保该文件不会被上传到 Git 仓库。笔者已提前将 `api_env.env` 添加进 `.gitignore` 中。

#### 4. 启动后端服务

运行 Flask 应用：

```bash
python app.py
```

终端会显示服务已在 `http://127.0.0.1:5000` 启动。

#### 5. 打开前端页面

在你的网页浏览器中，直接打开 `Who_is_the_Spy_page.html` 文件即可观看游戏。

## 三、 待办事项 (To-Do List)

-   **动态增加更多平民与卧底词语**
    -   **现状**: 现有词语较少，且需要用户提前在后端设定好词语数据库。
    -   **目标**: 考虑人工在数据库中增加更多词语，或在每局游戏开始时，调用一个小模型，专门用来生成本局词语。

## 四、 前端示例

![演示](/sample_pic/sample_2.png)

## 五、 已完成的待办事项

- 人工调整智能体数量：实现了用户可以通过配置项或前端选项自由设定游戏的总人数和平民/卧底的数量。
- 增加最大游戏轮数限制：增加了可选的“最大回合数”限制，若在指定回合数内卧底未被找出，则判定卧底胜利。
