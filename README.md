# who_is_the_spy_multiagent

一个基于大语言模型的多智能体“谁是卧底”游戏模拟程序。

本项目通过Web界面实时展示四个AI智能体进行“谁是卧底”游戏的完整过程，包括每轮的发言、投票和最终的游戏结果。

## 一、 主要功能

-   **全自动游戏流程**：程序启动后，AI 玩家会自动完成发言、投票、淘汰等所有游戏环节，直至分出胜负。
-   **动态AI交互**：每个AI玩家都会根据场上已有的发言历史来组织自己的描述，并基于所有人的发言进行分析和投票。
-   **实时战况直播**：游戏日志、玩家发言和投票理由会通过流式传输实时显示在前端页面上，方便观察战局。
-   **上帝视角**：前端页面提供“上帝视角”开关，开启后可以查看所有玩家的身份（平民/卧底）和他们拿到的具体词语。
-   **动态淘汰机制**：每轮投票后，得票最多的玩家会被淘汰出局。 如果卧底被淘汰，则平民胜利；如果卧底存活到最后（场上剩余2人），则卧底胜利。

## 二、 如何运行

#### 1. 克隆仓库

```bash
git clone <你的仓库链接>
cd who_is_the_spy_multiagent
```

#### 2. 安装依赖

建议创建一个 Python 虚拟环境。项目依赖已在 `requirements.txt` 文件中列出，请使用以下命令安装：

```bash
pip install -r requirements.txt
```

#### 3. 配置 API 密钥

a. 本项目选择调用字节跳动[火山引擎](https://www.volcengine.com/)中的[豆包大模型](https://www.volcengine.com/product/doubao)，请使用者自行前往火山引擎生成自己的 API 密钥，笔者此处不再赘述。

b. 在项目根目录下，复制 `.env.example` 文件并重命名为 `.env`（或 `api_env.env`，根据你的偏好）。

c. 在新建的 `.env` 文件中，添加你的 API 密钥，格式如下：

   ```
   ARK_API_KEY="YOUR_API_KEY_HERE"

   # 例如
   ARK_API_KEY="abcdabcd_abcd_1111"
   ```

d. **（重要！）** 为了防止密钥泄露，请务必在 `.gitignore` 文件中将您的密钥文件添加进去，确保该文件不会被上传到 Git 仓库。

#### 4. 启动后端服务

运行 Flask 应用：

```bash
python app.py
```

终端会显示服务已在 `http://127.0.0.1:5000` 启动。

#### 5. 打开前端页面

在你的网页浏览器中，直接打开 `Who_is_the_Spy_page.html` 文件即可观看游戏。

## 三、 待办事项 (To-Do List)

-   **人工调整智能体数量**
    -   **现状**: 当前玩家数量硬编码为4人（3平民 vs 1卧底）。
    -   **目标**: 增加一个配置项或在前端提供选项，允许用户自由设定游戏的总人数和平民/卧底的数量。

-   **增加最大游戏轮数限制**
    -   **现状**: 游戏只有在卧底被找出或卧底存活到最后两种情况下才会结束。
    -   **目标**: 增加一个可选的“最大回合数”限制。如果在指定回合数内卧底仍未被找出，则判定卧底胜利。这可以避免游戏陷入僵局，并增加一种新的胜利条件。

## 四、 前端示例

![演示](/sample_pic/sample_1.png)
